<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prep‚ÄìYear 2 Animal Maths | Free Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:#f3f7f5;
      margin:0;
      padding:24px;
    }
    .card{
      max-width:820px;
      margin:auto;
      background:#fff;
      border-radius:18px;
      padding:22px;
      box-shadow:0 10px 26px rgba(0,0,0,.08);
    }
    h1{margin:0 0 10px;color:#0b5ed7;font-weight:1000;}
    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(11,94,215,.08);
      border:1px solid rgba(11,94,215,.18);
      color:#0b5ed7;
      font-weight:900;
      margin-bottom:10px;
    }
    .intro{color:#555;font-weight:650;line-height:1.6;margin-bottom:10px;}
    .q{font-size:20px;font-weight:900;margin:14px 0 10px;}

    label{
      display:block;
      margin-bottom:6px;
      font-weight:800;
      color:#334155;
    }
    input,select{
      width:100%;
      padding:12px;
      font-size:16px;
      border-radius:12px;
      border:1px solid #ccc;
      box-sizing:border-box;
    }

    .row2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:24px;
      margin-bottom:14px;
    }
    .field{margin-bottom:14px;}
    @media (max-width:720px){ .row2{grid-template-columns:1fr;} }

    .btnrow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    button{
      padding:12px 16px;
      font-size:16px;
      font-weight:900;
      border-radius:12px;
      border:none;
      background:#0b5ed7;
      color:#fff;
      cursor:pointer;
    }
    button.secondary{
      background:#eef2ff;
      color:#0b5ed7;
    }
    button:disabled{opacity:.55;cursor:not-allowed;}

    .feedback{
      margin-top:12px;
      padding:12px;
      border-radius:12px;
      font-weight:800;
      line-height:1.5;
    }
    .ok{background:#e8fff0;border:1px solid #9be7b2;}
    .bad{background:#fff0f0;border:1px solid #f2a6a6;}

    .hide{display:none;}
    .note{
      margin-top:10px;
      color:#64748b;
      font-weight:650;
      font-size:14px;
      line-height:1.6;
    }

    .cta{
      margin-top:16px;
      padding:16px;
      border-radius:14px;
      background:#fff7e8;
      border:1px solid rgba(245,158,11,.35);
      color:#555;
      font-weight:700;
    }

    .resultBox{
      margin-top:16px;
      padding:14px;
      border-radius:14px;
      background:rgba(11,94,215,.05);
      border:1px solid rgba(11,94,215,.18);
    }
    .resultTitle{
      font-weight:1000;
      color:#0b5ed7;
      margin-bottom:6px;
    }

    canvas{
      width:100%;
      height:240px;
      background:#fff;
      border-radius:12px;
      border:1px solid rgba(0,0,0,.12);
      margin-top:8px;
    }

    ul{margin:6px 0 0 18px;}
    li{margin-bottom:6px;}

    .footer{
      margin-top:18px;
      padding-top:12px;
      border-top:1px dashed #ccc;
      text-align:center;
      color:#666;
      font-weight:650;
    }

    /* ===== Printable report toggle UI ===== */
    .toggleRow{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:12px;
      padding:10px 12px;
      border-radius:12px;
      background:#fff;
      border:1px solid rgba(2,6,23,.12);
    }
    .toggleRow input{width:auto; transform:scale(1.2);}
    .toggleRow label{margin:0;font-weight:800;}

    /* ===== PRINT STYLES ===== */
    .printReport{ display:none; }

    @media print{
      body{ background:#fff; padding:0; }
      .card{ box-shadow:none; padding:0; max-width:none; border-radius:0; }

      /* Hide everything except printable report */
      .card > *:not(#printReport){
        display:none !important;
      }

      #printReport{
        display:block !important;
        padding:18px;
        font-size:14px;
        line-height:1.6;
      }

      #printReport h2, #printReport h3 { color:#000; margin: 10px 0 6px; }
      #printReport .small { color:#333; font-size:13px; }
      #printReport ul{ margin-left:18px; }
      #printReport .divider{ border-top:1px solid #ddd; margin:12px 0; }
    }
  </style>
</head>

<body>
<div class="card">

  <div class="pill">üå± Prep ‚Äì Year 2 ‚Ä¢ Animals</div>
  <h1>Animal Maths Practice (Free Demo)</h1>

  <p class="intro">
    Type your answer, press <b>Check</b>, then press <b>Next</b>.
  </p>

  <!-- START -->
  <div id="startMsg" class="q">Enter your details, then press <b>Start</b> üêæ</div>

  <div id="profileBox">
    <div class="row2">
      <div class="field">
        <label>Student name</label>
        <input id="studentName" placeholder="e.g., Anna">
      </div>
      <div class="field">
        <label>Grade</label>
        <select id="studentGrade">
          <option value="">Select‚Ä¶</option>
          <option>Prep</option>
          <option>Year 1</option>
          <option>Year 2</option>
        </select>
      </div>
    </div>
    <div class="note">
      This short demo helps us understand how your child thinks. No email or phone number is collected.
    </div>
  </div>

  <div id="startButtons" class="btnrow">
    <button onclick="start()">Start</button>
  </div>

  <!-- QUIZ -->
  <div id="qa" class="hide">
    <div id="q" class="q"></div>
    <input id="ans" inputmode="numeric" placeholder="Type a number">

    <div class="btnrow">
      <button id="checkBtn" onclick="check()">Check</button>
      <button id="nextBtn" class="secondary" onclick="next()" disabled>Next</button>
    </div>
  </div>

  <div id="fb"></div>

  <!-- END / RESULTS -->
  <div id="end" class="cta hide">
    <div id="finalLine"></div>

    <!-- Graph -->
    <div class="resultBox">
      <div class="resultTitle">Results overview</div>
      <div id="pctText"></div>
      <canvas id="chart" width="900" height="260"></canvas>
      <div class="note">Blue bar = correct (1) ‚Ä¢ Red bar = not yet correct (0)</div>
    </div>

    <!-- Parent summary -->
    <div class="resultBox">
      <div class="resultTitle">üë®‚Äçüë©‚Äçüëß Parent Summary</div>

      <p id="parentOverview"></p>

      <p><b>What your child did well:</b></p>
      <ul id="strengthList"></ul>

      <p><b>What to practise next:</b></p>
      <ul id="nextList"></ul>

      <p class="note">
        This demo is <b>not a test</b>. It helps us plan calm, confidence-building lessons.
      </p>
    </div>

    <!-- Parent can choose to include report -->
    <div class="toggleRow">
      <input id="includeReport" type="checkbox" checked>
      <label for="includeReport">Include a printable report (PDF)</label>
    </div>

    <div class="btnrow">
      <button onclick="printOrSkip()">üñ®Ô∏è Print / Save PDF</button>
      <button class="secondary" onclick="restart()">Try again</button>
    </div>

    <div id="saveStatus" class="note"></div>

    <div class="note">
      Interested in a personalised learning plan?
      <a href="https://www.magicmathmaster.com.au/contact.html" target="_blank" rel="noopener">Enquire or register ‚Üí</a>
    </div>
  </div>

  <!-- PRINT REPORT (only appears if parent chooses it) -->
  <div id="printReport" class="printReport">
    <h2>Maths Practice Report</h2>
    <p class="small">
      <b>Student:</b> <span id="rName"></span><br>
      <b>Grade:</b> <span id="rGrade"></span><br>
      <b>Date:</b> <span id="rDate"></span>
    </p>

    <div class="divider"></div>

    <h3>Summary</h3>
    <p id="rSummary"></p>

    <h3>What your child did well</h3>
    <ul id="rStrengths"></ul>

    <h3>What to practise next</h3>
    <ul id="rNext"></ul>

    <div class="divider"></div>

    <p class="small">
      This short demo is not a test. It helps us plan calm, confidence-building lessons.<br>
      Magic Math Master ‚Ä¢ Australia ‚Ä¢ www.magicmathmaster.com.au
    </p>
  </div>

  <div class="footer">Magic Math Master ‚Ä¢ Free Demo</div>
</div>

<script>
/* ================= CONFIG ================= */
const ENDPOINT_URL =
  "https://script.google.com/macros/s/AKfycbwvWZJLRflPGQA3s5P2-B5LkTFonS4Z1SPI5-85lzlj1lFY02qXJzTd239PsiB0WICr/exec";

/* Keep questions simple and age-appropriate */
const qs = [
  { q:"üê∂ There are 5 puppies and 2 kittens. How many animals altogether?", a:7, skill:"addition" },
  { q:"üê∞ 9 rabbits are in a pen. 3 hop away. How many are left?", a:6, skill:"subtraction" },
  { q:"üê§ 4 nests. Each nest has 2 chicks. How many chicks?", a:8, skill:"groups" },
  { q:"ü¶Å 3 lions. Each has 4 legs. How many legs?", a:12, skill:"groups" },
  { q:"üê¢ You see 10 turtles. 1 hides. How many can you see now?", a:9, skill:"subtraction" },
  { q:"üê† 6 fish swim by. Then 6 more swim by. How many fish?", a:12, skill:"addition" }
];

let i=-1, score=0;
let student={name:"",grade:""};
let gotCorrect=new Array(qs.length).fill(false);

const el=id=>document.getElementById(id);

/* ================= FLOW ================= */
function start(){
  student.name=el("studentName").value.trim();
  student.grade=el("studentGrade").value || "‚Äî";
  if(!student.name){ alert("Please enter the student name."); return; }

  el("profileBox").style.display="none";
  el("startButtons").style.display="none";
  el("startMsg").style.display="none";
  el("qa").classList.remove("hide");

  next();
}

function next(){
  i++;
  el("fb").textContent="";
  el("fb").className="";
  el("nextBtn").disabled=true;
  el("ans").value="";

  if(i>=qs.length){ finish(); return; }
  el("q").textContent=qs[i].q;
  el("ans").focus();
}

function check(){
  const v = Number(el("ans").value);
  if(!Number.isFinite(v)){
    el("fb").className="feedback bad";
    el("fb").textContent="Please type a number.";
    return;
  }

  const correct = (v === qs[i].a);

  if(correct){
    if(!gotCorrect[i]) score++;
    gotCorrect[i]=true;
    el("fb").className="feedback ok";
    el("fb").textContent="‚úÖ Correct!";
  }else{
    el("fb").className="feedback bad";
    el("fb").textContent="Not quite ‚Äî try again, then press Check.";
  }

  // OPTION B: allow Next only after Check
  el("nextBtn").disabled=false;
}

function finish(){
  el("qa").style.display="none";
  el("end").classList.remove("hide");

  const pct = Math.round(score / qs.length * 100);
  el("finalLine").textContent = `Score: ${score}/${qs.length} (${pct}%)`;
  el("pctText").textContent = `Percentage correct: ${pct}%`;

  drawChart(gotCorrect.map(v=>v?1:0));
  buildParentSummary();
  saveResult(pct);
}

/* ================= GRAPH ================= */
function drawChart(vals){
  const c=el("chart"), ctx=c.getContext("2d");
  ctx.clearRect(0,0,c.width,c.height);

  const W=c.width, H=c.height;
  const L=52, R=18, T=18, B=45;
  const n=vals.length;
  const chartW=W-L-R, chartH=H-T-B;

  // axes
  ctx.strokeStyle="#111827";
  ctx.lineWidth=2;
  ctx.beginPath();
  ctx.moveTo(L,T);
  ctx.lineTo(L,H-B);
  ctx.lineTo(W-R,H-B);
  ctx.stroke();

  // y labels
  ctx.fillStyle="#111827";
  ctx.font="14px system-ui";
  ctx.fillText("1", 30, T+10);
  ctx.fillText("0", 30, H-B+6);

  const gap=12;
  const barW=Math.max(24, (chartW - gap*(n-1))/n);

  vals.forEach((v,i)=>{
    const barH=v*chartH;
    const x=L + i*(barW+gap);
    const y=(H-B)-barH;

    ctx.fillStyle = v ? "rgba(11,94,215,.85)" : "rgba(239,68,68,.70)";
    ctx.fillRect(x,y,barW,barH);

    ctx.fillStyle="#111827";
    ctx.font="12px system-ui";
    ctx.fillText(`Q${i+1}`, x+6, H-B+18);
    ctx.fillText(String(v), x+barW/2-3, y-6);
  });
}

/* ================= PARENT SUMMARY ================= */
function buildParentSummary(){
  const strengths = [];
  const nextSteps = [];

  qs.forEach((q,i)=>{
    const plain = q.q.replace(/^[^ ]+ /,""); // remove emoji for summary
    if(gotCorrect[i]) strengths.push(plain);
    else nextSteps.push(plain);
  });

  // Overview tone
  let overview = "";
  if(score === qs.length){
    overview = "üåü Excellent work! Your child showed strong understanding across all questions today.";
  }else if(score >= qs.length*0.6){
    overview = "üëç Your child shows developing understanding, with a few areas to strengthen.";
  }else{
    overview = "üå± Your child is still building confidence, which is very normal at this stage.";
  }

  el("parentOverview").textContent = overview;

  el("strengthList").innerHTML = strengths.length
    ? strengths.slice(0,4).map(s=>`<li>${s}</li>`).join("")
    : "<li>Showing effort and persistence ‚Äî a strong learning skill.</li>";

  el("nextList").innerHTML = nextSteps.length
    ? nextSteps.slice(0,4).map(s=>`<li>${s}</li>`).join("")
    : "<li>Continue practising to build speed and confidence.</li>";
}

/* ================= OPTIONAL PRINT REPORT ================= */
function printOrSkip(){
  const include = el("includeReport").checked;
  if(!include){
    alert("Report is turned off. Tick 'Include a printable report' if you want to print/save a PDF.");
    return;
  }
  buildPrintReport();
  window.print();
}

function buildPrintReport(){
  const pct = Math.round(score / qs.length * 100);
  const results01 = gotCorrect.map(v=>v?1:0);

  // Fill header
  el("rName").textContent = student.name;
  el("rGrade").textContent = student.grade || "‚Äî";
  el("rDate").textContent = new Date().toLocaleDateString();

  // Summary sentence
  el("rSummary").textContent =
    `Score: ${score}/${qs.length} (${pct}%). ` +
    (score===qs.length ? "Strong understanding across all questions."
      : score>=qs.length*0.6 ? "Developing understanding with some areas to strengthen."
      : "Still building confidence ‚Äî very normal at this stage.");

  // Strengths + next steps
  const strengths = qs.filter((_,i)=>results01[i]===1).map(q=>q.q.replace(/^[^ ]+ /,""));
  const nextSteps  = qs.filter((_,i)=>results01[i]===0).map(q=>q.q.replace(/^[^ ]+ /,""));

  el("rStrengths").innerHTML = strengths.length
    ? strengths.map(s=>`<li>${s}</li>`).join("")
    : "<li>Showing effort and persistence.</li>";

  el("rNext").innerHTML = nextSteps.length
    ? nextSteps.map(s=>`<li>${s}</li>`).join("")
    : "<li>Continue practising to build speed and confidence.</li>";
}

/* ================= SAVE TO SHEET ================= */
async function saveResult(pct){
  el("saveStatus").textContent="Sending result‚Ä¶";

  try{
    await fetch(ENDPOINT_URL,{
      method:"POST",
      mode:"no-cors",
      headers:{ "Content-Type":"text/plain;charset=utf-8" },
      body:JSON.stringify({
        level:"Prep‚Äì2",
        name:student.name,
        grade:student.grade,
        score:score,
        total:qs.length,
        percent:pct,
        perQuestion01:gotCorrect.map(v=>v?1:0),
        pageUrl:location.href,
        userAgent:navigator.userAgent
      })
    });
    el("saveStatus").textContent="‚úÖ Result sent.";
  }catch(e){
    el("saveStatus").textContent="‚ö†Ô∏è Could not send result (temporary issue).";
  }
}

/* ================= RESET ================= */
function restart(){
  location.reload();
}

/* Enter key triggers Check (kid-friendly) */
document.addEventListener("keydown", e=>{
  if(e.key === "Enter"){
    const quizVisible = !el("qa").classList.contains("hide") && el("qa").style.display !== "none";
    if(quizVisible){
      e.preventDefault();
      check();
    }
  }
});
</script>

</body>
</html>