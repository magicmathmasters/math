<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prep‚ÄìYear 2 Animal Maths | Free Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#f3f7f5;margin:0;padding:24px;}
    .card{max-width:720px;margin:auto;background:#fff;border-radius:18px;padding:22px;box-shadow:0 10px 26px rgba(0,0,0,.08);}
    h1{margin:0 0 10px;color:#0b5ed7;font-weight:1000;}
    .intro{color:#555;font-weight:650;line-height:1.6;margin-bottom:10px;}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(11,94,215,.08);border:1px solid rgba(11,94,215,.18);color:#0b5ed7;font-weight:900;margin-bottom:10px;}
    .q{font-size:20px;font-weight:900;margin:14px 0 10px;}
    input, select{width:100%;padding:12px;font-size:16px;border-radius:12px;border:1px solid #ccc;}
    label{display:block;margin-top:10px;font-weight:800;color:#334155;}
    .btnrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;}
    button{padding:12px 16px;font-size:16px;font-weight:900;border-radius:12px;border:none;background:#0b5ed7;color:#fff;cursor:pointer;}
    button.secondary{background:#eef2ff;color:#0b5ed7;}
    .feedback{margin-top:12px;padding:12px;border-radius:12px;font-weight:800;line-height:1.5;}
    .ok{background:#e8fff0;border:1px solid #9be7b2;}
    .bad{background:#fff0f0;border:1px solid #f2a6a6;}
    .cta{margin-top:16px;padding:14px;border-radius:14px;background:#fff7e8;border:1px solid rgba(245,158,11,.35);color:#555;font-weight:700;line-height:1.6;}
    .cta a{color:#7a4a00;font-weight:1000;text-decoration:none;border-bottom:1px solid rgba(122,74,0,.35);}
    .cta a:hover{border-bottom-color:rgba(122,74,0,.7);}
    .footer{margin-top:16px;padding-top:12px;border-top:1px dashed #ccc;text-align:center;color:#666;font-weight:650;}
    .back a{font-weight:900;color:#0b5ed7;text-decoration:none;border-bottom:1px solid rgba(11,94,215,.35);}
    .back a:hover{border-bottom-color:rgba(11,94,215,.7);}
    .hide{display:none;}
    .note{margin-top:10px;color:#64748b;font-weight:650;line-height:1.6;font-size:14px;}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media (max-width:720px){.row2{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="card">
    <div class="pill">üå± Prep ‚Äì Year 2 ‚Ä¢ Animals</div>
    <h1>Animal Maths Practice (Free Demo)</h1>

    <p class="intro">
      A short, friendly demo for young learners. When you see a question, type your answer (a number).
    </p>

    <p class="back" style="margin:0 0 6px;">
      <a href="../">‚Üê Back to level select</a>
    </p>

    <!-- Start screen -->
    <div id="startMsg" class="q">Enter your details, then press <b>Start</b> üêæ</div>

    <div id="profileBox">
      <div class="row2">
        <div>
          <label for="studentName">Student name</label>
          <input id="studentName" placeholder="e.g., Anna" autocomplete="name">
        </div>
        <div>
          <label for="studentGrade">Grade</label>
          <select id="studentGrade">
            <option value="">Select‚Ä¶</option>
            <option>Prep</option>
            <option>Year 1</option>
            <option>Year 2</option>
          </select>
        </div>
      </div>

      <div class="note">
        Privacy: this demo will save the student‚Äôs <b>name, grade, and score</b> to Magic Math Master‚Äôs records (Google Sheet) to help improve lessons.
        No email/phone is collected here.
      </div>
    </div>

    <!-- Question + answer area (hidden until started) -->
    <div id="qa" class="hide">
      <div id="q" class="q"></div>
      <input id="ans" inputmode="numeric" placeholder="Type a number (e.g., 7)">
      <div class="btnrow">
        <button id="checkBtn" onclick="check()">Check</button>
        <button id="nextBtn" class="secondary" onclick="next()">Next</button>
      </div>
    </div>

    <!-- Start button -->
    <div id="startButtons" class="btnrow">
      <button onclick="start()">Start</button>
    </div>

    <div id="fb"></div>

    <div id="end" class="cta" style="display:none;">
      üéâ <b>Well done!</b> This was a short demo.<br><br>
      Want a personalised plan and full practice sets? üëâ
      <a href="https://www.magicmathmaster.com.au/contact.html" target="_blank" rel="noopener">Enquire / Register ‚Üí</a>
      <div id="saveStatus" class="note" style="margin-top:10px;"></div>
    </div>

    <div class="footer">Magic Math Master ‚Ä¢ Free Demo</div>
  </div>

<script>
  /*********** 1) CONFIG: paste your Apps Script Web App URL here ***********/
   const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbwvWZJLRflPGQA3s5P2-B5LkTFonS4Z1SPI5-85lzlj1lFY02qXJzTd239PsiB0WICr/exec";

  /*********** 2) Questions ***********/
  const qs = [
    { q: "üê∂ There are 5 puppies and 2 kittens. How many animals altogether?", a: 7, tip:"Add: 5 + 2" },
    { q: "üê∞ 9 rabbits are in a pen. 3 hop away. How many are left?", a: 6, tip:"Subtract: 9 ‚àí 3" },
    { q: "üê§ 4 nests. Each nest has 2 chicks. How many chicks?", a: 8, tip:"Groups of 2: 4 √ó 2" },
    { q: "ü¶Å Count the legs: 3 lions. Each has 4 legs. How many legs?", a: 12, tip:"3 √ó 4" },
    { q: "üê¢ You see 10 turtles. 1 hides. How many can you see now?", a: 9, tip:"10 ‚àí 1" },
    { q: "ü¶â Owl hoots: 2 hoots, then 4 hoots, then 6 hoots. What comes next?", a: 8, tip:"It goes up by 2 each time." },
    { q: "üê† 6 fish swim by. Then 6 more swim by. How many fish?", a: 12, tip:"6 + 6" },
    { q: "ü¶ã There are 14 butterflies. 7 fly away. How many are left?", a: 7, tip:"14 ‚àí 7" }
  ];

  let i = -1;
  let student = { name: "", grade: "" };

  // Track answers and score
  let answersLog = [];
  let score = 0;
  let gotCorrect = new Array(qs.length).fill(false); // so we only count each question once

  // Load saved profile from this device (optional)
  (function loadProfile(){
    try{
      const saved = JSON.parse(localStorage.getItem("mmm_demo_profile") || "null");
      if(saved && typeof saved === "object"){
        if(saved.name) document.getElementById("studentName").value = saved.name;
        if(saved.grade) document.getElementById("studentGrade").value = saved.grade;
      }
    }catch(e){}
  })();

  function clearFeedback(){
    const fb = document.getElementById("fb");
    fb.className = "";
    fb.textContent = "";
  }

  async function sendResultToSheet(payload){
    if(!ENDPOINT_URL || ENDPOINT_URL.includes("PASTE_YOUR")){
      return { ok:false, error:"Missing Apps Script URL" };
    }
    try{
      const res = await fetch(ENDPOINT_URL, {
        method: "POST",
        headers: {"Content-Type":"text/plain;charset=utf-8"},
        body: JSON.stringify(payload)
      });
      const out = await res.json().catch(()=> ({}));
      return out;
    }catch(err){
      return { ok:false, error:String(err) };
    }
  }

  function start(){
    const name = document.getElementById("studentName").value.trim();
    const grade = document.getElementById("studentGrade").value;

    if(!name){
      const fb = document.getElementById("fb");
      fb.className = "feedback bad";
      fb.textContent = "Please type the student name, then press Start.";
      return;
    }

    student.name = name;
    student.grade = grade || "";

    // Save locally on this device
    try{
      localStorage.setItem("mmm_demo_profile", JSON.stringify({name: student.name, grade: student.grade}));
    }catch(e){}

    // Hide profile/start UI
    document.getElementById("startMsg").style.display = "none";
    document.getElementById("profileBox").style.display = "none";
    document.getElementById("startButtons").style.display = "none";

    // Show question/answer UI
    document.getElementById("qa").classList.remove("hide");
    clearFeedback();

    next();
  }

  async function finishAndSave(){
    // Show a small status message (optional)
    const saveEl = document.getElementById("saveStatus");
    if(saveEl){
      saveEl.textContent = "Saving your result‚Ä¶";
    }

    const payload = {
      level: "Prep‚Äì2",
      name: student.name,
      grade: student.grade,
      score: score,
      total: qs.length,
      answers: answersLog,
      userAgent: navigator.userAgent,
      pageUrl: location.href
    };

    const out = await sendResultToSheet(payload);

    if(saveEl){
      if(out && out.ok){
        saveEl.textContent = "‚úÖ Result saved. Thank you!";
      }else{
        saveEl.textContent = "‚ö†Ô∏è Result not saved (temporary issue). You can still continue browsing.";
        console.log("Save error:", out);
      }
    }
  }

  function next(){
    i++;
    clearFeedback();
    document.getElementById("ans").value = "";
    document.getElementById("ans").focus();

    if(i >= qs.length){
      document.getElementById("q").textContent = `üèÅ Finished! Great effort, ${student.name}! (Score: ${score}/${qs.length})`;
      document.getElementById("end").style.display = "block";
      document.getElementById("ans").style.display = "none";
      document.getElementById("checkBtn").style.display = "none";
      document.getElementById("nextBtn").style.display = "none";

      // Send result to Google Sheet
      finishAndSave();
      return;
    }

    document.getElementById("q").textContent = qs[i].q;
  }

  function check(){
    if(i < 0) return;

    const raw = document.getElementById("ans").value.trim();
    const user = Number(raw);
    const fb = document.getElementById("fb");

    if(!Number.isFinite(user)){
      fb.className = "feedback bad";
      fb.textContent = "Please type a number (like 6).";
      return;
    }

    const correct = (user === qs[i].a);

    // Log attempt
    answersLog.push({
      qIndex: i,
      question: qs[i].q,
      userAnswer: raw,
      correctAnswer: qs[i].a,
      correct: correct,
      time: new Date().toISOString()
    });

    // Score: count each question at most once (first time they get it correct)
    if(correct && !gotCorrect[i]){
      gotCorrect[i] = true;
      score += 1;
    }

    if(correct){
      fb.className = "feedback ok";
      fb.textContent = `‚úÖ Correct, ${student.name}! üêæ`;
    } else {
      fb.className = "feedback bad";
      fb.textContent = `‚ùå Not quite, ${student.name}. Hint: ${qs[i].tip}`;
    }
  }
</script>
</body>

</html>
